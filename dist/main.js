(()=>{"use strict";const e=document.querySelector("#content"),t=document.createElement("head"),l=document.createElement("main"),i=document.createElement("footer");e.appendChild(t),e.appendChild(l),e.appendChild(i);const n=(e,t)=>{let l=document.createElement("td");return l.classList.add("playerGrid"),l.dataset.row=e,l.dataset.col=t,l},r=e=>{let t=document.createElement("th");return t.textContent=e,t},a=e=>{let t=document.createElement("tr");t.dataset.row=e,t.appendChild(r(e));for(let l=0;l<10;l++)t.appendChild(n(e,l));return t},d=()=>{const e=document.createElement("table");e.appendChild((()=>{let e=document.createElement("tr");return e.appendChild(r("&nbsp;")),e.appendChild(r("A")),e.appendChild(r("B")),e.appendChild(r("C")),e.appendChild(r("D")),e.appendChild(r("E")),e.appendChild(r("F")),e.appendChild(r("G")),e.appendChild(r("H")),e.appendChild(r("I")),e.appendChild(r("J")),e})());for(let t=0;t<10;t++)e.appendChild(a(t));return e},o=(e,t="noID",l="south")=>{const i=t,n=e,r=l;let a=0,d=!1;return{getHitsSustained:()=>a,hit:()=>{console.log("HIT"),a++,a===n&&(d=!0,console.log("SUNK"))},isSunk:()=>d,getLength:()=>n,getDirection:()=>r,getID:()=>i}},c=()=>{const e=Array(10).fill().map((()=>Array(10).fill(null))),t=Array(10).fill().map((()=>Array(10).fill(null))),l=[],i=(e,t)=>e>=0&&e<10&&t>=0&&t<10,n=(t,n,r)=>{if(!((t,l,n)=>{let r="south"===t.getDirection()?1:0,a="east"===t.getDirection()?1:0;for(let d=0;d<t.getLength();d++){if(!i(l,n))return!1;if(null!=e[l][n])return!1;l+=r,n+=a}return!0})(t,n,r))throw new Error(`Failed to place ship ${t.getID()} at row: ${n}, col: ${r}`);l.push(t);let a="south"===t.getDirection()?1:0,d="east"===t.getDirection()?1:0;for(let l=0;l<t.getLength();l++)e[n][r]=t,n+=a,r+=d};return{placeShip:n,receiveAttack:(l,i)=>{t[l][i]="hit",e[l][i]&&e[l][i].hit()},isValidAttack:(e,l)=>i(e,l)&&null===t[e][l],isDefeated:()=>{for(let e of l)if(!e.isSunk())return!1;return!0},initDefaultShips:()=>{let e=o(4,"a","east");n(e,0,4),l.push(e);let t=o(2,"b","south");n(t,0,9),l.push(t);let i=o(2,"c","east");n(i,2,0),l.push(i);let r=o(3,"d","south");n(r,3,4),l.push(r);let a=o(1,"e","south");n(a,3,6),l.push(a);let d=o(3,"f","south");n(d,4,9),l.push(d);let c=o(2,"g","east");n(c,5,0),l.push(c);let p=o(1,"h");n(p,8,0),l.push(p);let s=o(1,"i");n(s,9,5),l.push(s);let h=o(1,"j");n(h,9,9),l.push(h)},getShipGrid:()=>e}};(()=>{let e=(()=>{const e=c(),t=c();e.initDefaultShips(),t.initDefaultShips();const l=(e=>{let t=()=>Math.floor(10*Math.random());return{pickTargetSimple:()=>{let l=t(),i=t();for(;!e.isValidAttack(l,i);)l=t(),i=t();return{row:l,col:i}}}})(t);let i;return{runGameLoop:()=>{for(;i=getPlayerAttackCoordinates(),t.receiveAttack(i.row,i.col),!t.isDefeated()&&(i=l.pickTargetSimple(),e.receiveAttack(i.row,i.col),!e.isDefeated()););},getShipGrid:()=>e.getShipGrid(),processUserInput:(e,l)=>{console.log(`Valid attack (${e}, ${l}): ${t.isValidAttack(e,l)}`),t.isValidAttack(e,l)&&t.receiveAttack(e,l)},isValidAttack:(e,l)=>t.isValidAttack(e,l)}})();const t=(t,l,i)=>{e.isValidAttack(t,l)&&(e=>{console.log(e.target);let t=document.createElement("div");t.classList.add("hit"),t.textContent="hit",e.target.appendChild(t)})(i),e.processUserInput(t,l)};return{initiate:()=>{((e,t)=>{const l=document.querySelector("#content");let i=d();l.appendChild(i),((e,t)=>{for(let l=0;l<10;l++)for(let i=0;i<10;i++)if(e[l][i]){let e=t.children[l+1].children[i+1],n=document.createElement("div");n.classList.add("ship"),n.textContent="s",e.appendChild(n)}})(e.getShipGrid(),i),l.appendChild((e=>{let t=d();for(let l=0;l<10;l++)for(let i=0;i<10;i++)t.children[l+1].children[i+1].onclick=t=>{e(l,i,t)};return t})(t))})(e,t)},processUserInput:t,getShipGrid:()=>e.getShipGrid()}})().initiate()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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R0FBSUEsSUFFdkIsR0FBRzJCLEVBQVM1QixHQUFLQyxHQUFLLENBQ2xCLElBR0krRSxFQUhXRCxFQUFNRSxTQUFTakYsRUFBTSxHQUdoQmlGLFNBQVNoRixFQUFNLEdBQy9CMkUsRUFBUTFGLFNBQVNHLGNBQWMsT0FDbkN1RixFQUFNL0UsVUFBVUMsSUFBSSxRQUNwQjhFLEVBQU14RSxZQUFjLElBRXBCNEUsRUFBS3hGLFlBQVlvRixFQUNyQixDQUVSLEVBeUJBTSxDQUFheEIsRUFBS0QsY0FBZXNCLEdBQ2pDOUYsRUFBVU8sWUF2QlksQ0FBQ2dGLElBQ3pCLElBQUlXLEVBQWE1RSxJQUNqQixJQUFJLElBQUlQLEVBQU0sRUFBR0EsRUFBTSxHQUFJQSxJQUN2QixJQUFJLElBQUlDLEVBQU0sRUFBR0EsRUFBTSxHQUFJQSxJQUNSa0YsRUFBV0YsU0FBU2pGLEVBQU0sR0FDckJpRixTQUFTaEYsRUFBTSxHQUU5Qm1GLFFBQVdWLElBQ2RGLEVBQWlCeEUsRUFBS0MsRUFBS3lFLEVBQU0sRUFLM0MsT0FBT1MsQ0FBVSxFQVVPRSxDQUFrQmIsR0FBa0IsRUMrSHREYyxDQUFVNUIsRUFBTWMsRUFBaUIsRUFHbEJBLG1CQUFrQmYsWUFkakIsSUFDVEMsRUFBS0QsY0Fha0MsRUFJekM4QixHQUNSVCxVIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy92aWV3Q29udHJvbGxlci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY29udGVudFwiKTtcblxuY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImhlYWRcIik7XG5jb25zdCBtYWluID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm1haW5cIik7XG5jb25zdCBmb290ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZm9vdGVyXCIpO1xuXG5jb250YWluZXIuYXBwZW5kQ2hpbGQoaGVhZGVyKTtcbmNvbnRhaW5lci5hcHBlbmRDaGlsZChtYWluKTtcbmNvbnRhaW5lci5hcHBlbmRDaGlsZChmb290ZXIpO1xuXG5jb25zdCBjcmVhdGVDZWxsID0gKG15Um93LCBteUNvbCkgPT4ge1xuICBsZXQgb3V0cHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRkXCIpO1xuICBvdXRwdXQuY2xhc3NMaXN0LmFkZChcInBsYXllckdyaWRcIik7XG4gIG91dHB1dC5kYXRhc2V0LnJvdyA9IG15Um93O1xuICBvdXRwdXQuZGF0YXNldC5jb2wgPSBteUNvbDtcbiAgcmV0dXJuIG91dHB1dFxufVxuXG5cbmNvbnN0IGNyZWF0ZVRhYmxlSGVhZGVyID0gKGNvbnRlbnQpID0+IHtcbiAgbGV0IG91dHB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0aFwiKTtcbiAgb3V0cHV0LnRleHRDb250ZW50ID0gY29udGVudDtcbiAgcmV0dXJuIG91dHB1dDtcbn1cblxuY29uc3QgY3JlYXRlVG9wUm93ID0gKCkgPT4ge1xuICBsZXQgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRyXCIpO1xuICByb3cuYXBwZW5kQ2hpbGQoY3JlYXRlVGFibGVIZWFkZXIoXCImbmJzcDtcIikpO1xuICByb3cuYXBwZW5kQ2hpbGQoY3JlYXRlVGFibGVIZWFkZXIoXCJBXCIpKTtcbiAgcm93LmFwcGVuZENoaWxkKGNyZWF0ZVRhYmxlSGVhZGVyKFwiQlwiKSk7XG4gIHJvdy5hcHBlbmRDaGlsZChjcmVhdGVUYWJsZUhlYWRlcihcIkNcIikpO1xuICByb3cuYXBwZW5kQ2hpbGQoY3JlYXRlVGFibGVIZWFkZXIoXCJEXCIpKTtcbiAgcm93LmFwcGVuZENoaWxkKGNyZWF0ZVRhYmxlSGVhZGVyKFwiRVwiKSk7XG4gIHJvdy5hcHBlbmRDaGlsZChjcmVhdGVUYWJsZUhlYWRlcihcIkZcIikpO1xuICByb3cuYXBwZW5kQ2hpbGQoY3JlYXRlVGFibGVIZWFkZXIoXCJHXCIpKTtcbiAgcm93LmFwcGVuZENoaWxkKGNyZWF0ZVRhYmxlSGVhZGVyKFwiSFwiKSk7XG4gIHJvdy5hcHBlbmRDaGlsZChjcmVhdGVUYWJsZUhlYWRlcihcIklcIikpO1xuICByb3cuYXBwZW5kQ2hpbGQoY3JlYXRlVGFibGVIZWFkZXIoXCJKXCIpKTtcbiAgcmV0dXJuIHJvdztcbn1cblxuY29uc3QgY3JlYXRlUm93ID0gKHJvd051bWJlcikgPT4ge1xuICBsZXQgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRyXCIpO1xuICByb3cuZGF0YXNldC5yb3cgPSByb3dOdW1iZXI7XG4gIHJvdy5hcHBlbmRDaGlsZChjcmVhdGVUYWJsZUhlYWRlcihyb3dOdW1iZXIpKTtcbiAgZm9yKGxldCBjb2wgPSAwOyBjb2wgPCAxMDsgY29sKyspe1xuICAgIHJvdy5hcHBlbmRDaGlsZChjcmVhdGVDZWxsKHJvd051bWJlciwgY29sKSk7XG4gIH1cbiAgcmV0dXJuIHJvdztcbn1cblxuY29uc3QgY3JlYXRlVGFibGUgPSAoKSA9PiB7XG4gIGNvbnN0IG15VGFibGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGFibGVcIik7XG4gIG15VGFibGUuYXBwZW5kQ2hpbGQoY3JlYXRlVG9wUm93KCkpO1xuICBmb3IobGV0IHJvdyA9IDA7IHJvdyA8IDEwOyByb3crKyl7XG4gICAgbXlUYWJsZS5hcHBlbmRDaGlsZChjcmVhdGVSb3cocm93KSk7XG4gIH1cblxuICByZXR1cm4gbXlUYWJsZTtcbn1cblxuY29uc3QgZGlzcGxheVNoaXBzID0gKHNoaXBHcmlkLCB0YWJsZSkgPT4ge1xuICAgIGZvcihsZXQgcm93ID0gMDsgcm93IDwgMTA7IHJvdysrKXtcbiAgICAgICAgZm9yKGxldCBjb2wgPSAwOyBjb2wgPCAxMDsgY29sKyspe1xuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhzaGlwR3JpZFtyb3ddW2NvbF0pO1xuICAgICAgICAgICAgaWYoc2hpcEdyaWRbcm93XVtjb2xdKXtcbiAgICAgICAgICAgICAgICBsZXQgdGFibGVSb3cgPSB0YWJsZS5jaGlsZHJlbltyb3cgKyAxXTtcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdoZWxsbycpO1xuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2codGFibGVSb3cpO1xuICAgICAgICAgICAgICAgIGxldCBjZWxsID0gdGFibGVSb3cuY2hpbGRyZW5bY29sICsgMV07XG4gICAgICAgICAgICAgICAgbGV0IG15RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgICAgICAgICBteURpdi5jbGFzc0xpc3QuYWRkKFwic2hpcFwiKVxuICAgICAgICAgICAgICAgIG15RGl2LnRleHRDb250ZW50ID0gXCJzXCI7XG4gICAgICAgICAgICAgICAgLy9jZWxsLnRleHRDb250ZW50ID0gXCJhc2RmYXNcIjtcbiAgICAgICAgICAgICAgICBjZWxsLmFwcGVuZENoaWxkKG15RGl2KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuY29uc3QgYXR0YWNrR3JpZEZhY3RvcnkgPSAocHJvY2Vzc1VzZXJJbnB1dCkgPT4ge1xuICBsZXQgYXR0YWNrR3JpZCA9IGNyZWF0ZVRhYmxlKCk7XG4gIGZvcihsZXQgcm93ID0gMDsgcm93IDwgMTA7IHJvdysrKXtcbiAgICAgIGZvcihsZXQgY29sID0gMDsgY29sIDwgMTA7IGNvbCsrKXtcbiAgICAgICAgICBsZXQgdGFibGVSb3cgPSBhdHRhY2tHcmlkLmNoaWxkcmVuW3JvdyArIDFdO1xuICAgICAgICAgIGxldCBjZWxsID0gdGFibGVSb3cuY2hpbGRyZW5bY29sICsgMV07XG4gICAgICAgICAgLy9jb25zb2xlLmxvZyhjZWxsKTtcbiAgICAgICAgICBjZWxsLm9uY2xpY2sgPSAoY2xpY2spID0+IHtcbiAgICAgICAgICAgIHByb2Nlc3NVc2VySW5wdXQocm93LCBjb2wsIGNsaWNrKTtcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coYG1hcmtpbmcgdGhpcyBmcm9tIG9uY2xpY2sgJHt0aGlzfWApO1xuICAgICAgICAgIH1cbiAgICAgIH1cbiAgfVxuICByZXR1cm4gYXR0YWNrR3JpZDtcblxufVxuXG5jb25zdCBzZXRVcFZpZXcgPSAoZ2FtZSwgcHJvY2Vzc1VzZXJJbnB1dCkgPT4ge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY29udGVudFwiKTtcbiAgICBsZXQgdGFibGUgPSBjcmVhdGVUYWJsZSgpO1xuICAgIC8vY29uc29sZS5sb2codGFibGUuY2hpbGRyZW4pO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0YWJsZSk7XG4gICAgZGlzcGxheVNoaXBzKGdhbWUuZ2V0U2hpcEdyaWQoKSwgdGFibGUpO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChhdHRhY2tHcmlkRmFjdG9yeShwcm9jZXNzVXNlcklucHV0KSk7XG59XG5cbmNvbnN0IG1hcmtBdHRhY2sgPSAoY2xpY2spID0+IHtcbiAgY29uc29sZS5sb2coY2xpY2sudGFyZ2V0KTtcbiAgbGV0IG15RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIG15RGl2LmNsYXNzTGlzdC5hZGQoJ2hpdCcpO1xuICBteURpdi50ZXh0Q29udGVudCA9ICdoaXQnO1xuICBjbGljay50YXJnZXQuYXBwZW5kQ2hpbGQobXlEaXYpO1xufVxuXG5leHBvcnQgeyBcbiAgICBzZXRVcFZpZXcsXG4gICAgbWFya0F0dGFja1xufTsiLCJpbXBvcnQgeyBcbiAgICBzZXRVcFZpZXcsXG4gICAgbWFya0F0dGFja1xufSBmcm9tICcuL3ZpZXdDb250cm9sbGVyJztcblxuY29uc3Qgc2hpcEZhY3RvcnkgPSAobGVuLCBzaGlwSUQgPSdub0lEJywgZGlyID0gJ3NvdXRoJykgPT4ge1xuICAgIGNvbnN0IGlkID0gc2hpcElEO1xuICAgIGNvbnN0IGxlbmd0aCA9IGxlbjtcbiAgICBjb25zdCBkaXJlY3Rpb24gPSBkaXI7XG4gICAgbGV0IGhpdHNTdXN0YWluZWQgPSAwO1xuICAgIGxldCBzdW5rID0gZmFsc2U7XG5cbiAgICBjb25zdCBnZXRIaXRzU3VzdGFpbmVkID0gKCkgPT4ge1xuICAgICAgICByZXR1cm4gaGl0c1N1c3RhaW5lZDtcbiAgICB9XG4gICAgY29uc3QgaGl0ID0gKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnSElUJyk7XG4gICAgICAgIGhpdHNTdXN0YWluZWQrKztcbiAgICAgICAgaWYoaGl0c1N1c3RhaW5lZCA9PT0gbGVuZ3RoKXtcbiAgICAgICAgICAgIHN1bmsgPSB0cnVlO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1NVTksnKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBpc1N1bmsgPSAoKSA9PiB7XG4gICAgICAgIHJldHVybiBzdW5rO1xuICAgIH1cbiAgICBjb25zdCBnZXRMZW5ndGggPSAoKSA9PiB7XG4gICAgICAgIHJldHVybiBsZW5ndGg7XG4gICAgfVxuICAgIGNvbnN0IGdldERpcmVjdGlvbiA9ICgpID0+IHtcbiAgICAgICAgcmV0dXJuIGRpcmVjdGlvbjtcbiAgICB9XG4gICAgY29uc3QgZ2V0SUQgPSAoKSA9PiB7XG4gICAgICAgIHJldHVybiBpZDtcbiAgICB9XG4gICAgcmV0dXJuIHsgZ2V0SGl0c1N1c3RhaW5lZCwgaGl0LCBpc1N1bmssIGdldExlbmd0aCwgXG4gICAgICAgIGdldERpcmVjdGlvbiwgZ2V0SUQgfTtcbn1cblxuY29uc3QgZ2FtZUJvYXJkRmFjdG9yeSA9ICgpID0+IHtcbiAgICBjb25zdCBzaGlwR3JpZCA9IEFycmF5KDEwKS5maWxsKCkubWFwKCgpID0+IEFycmF5KDEwKS5maWxsKG51bGwpKTtcbiAgICBjb25zdCBhdHRhY2tzID0gQXJyYXkoMTApLmZpbGwoKS5tYXAoKCkgPT4gQXJyYXkoMTApLmZpbGwobnVsbCkpO1xuICAgIGNvbnN0IHNoaXBBcnIgPSBbXTtcblxuICAgIGNvbnN0IGluQm91bmRzID0gKHJvdywgY29sKSA9PiB7XG4gICAgICAgIHJldHVybiByb3cgPj0gMCAmJiByb3cgPCAxMCAmJiBjb2wgPj0gMCAmJiBjb2wgPCAxMDtcbiAgICB9XG5cbiAgICBjb25zdCBpc1ZhbGlkU2hpcFBsYWNlbWVudCA9IChzaGlwLCByb3csIGNvbCkgPT4ge1xuICAgICAgICBsZXQgcm93TW9kID0gc2hpcC5nZXREaXJlY3Rpb24oKSA9PT0gJ3NvdXRoJyA/IDEgOiAwO1xuICAgICAgICBsZXQgY29sTW9kID0gc2hpcC5nZXREaXJlY3Rpb24oKSA9PT0gJ2Vhc3QnID8gMSA6IDA7XG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzaGlwLmdldExlbmd0aCgpOyBpKyspe1xuICAgICAgICAgICAgaWYoIWluQm91bmRzKHJvdywgY29sKSl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNoaXBHcmlkW3Jvd11bY29sXSAhPSBudWxsKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByb3cgPSByb3cgKyAocm93TW9kKTtcbiAgICAgICAgICAgIGNvbCA9IGNvbCArIChjb2xNb2QpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGNvbnN0IHBsYWNlU2hpcCA9IChzaGlwLCByb3csIGNvbCkgPT4ge1xuXG4gICAgICAgIGlmKCFpc1ZhbGlkU2hpcFBsYWNlbWVudChzaGlwLCByb3csIGNvbCkpe1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gcGxhY2Ugc2hpcCAke3NoaXAuZ2V0SUQoKX0gYXQgcm93OiAke3Jvd30sIGNvbDogJHtjb2x9YCk7XG4gICAgICAgIH1cblxuICAgICAgICBzaGlwQXJyLnB1c2goc2hpcCk7XG4gICAgICAgIGxldCByb3dNb2QgPSBzaGlwLmdldERpcmVjdGlvbigpID09PSAnc291dGgnID8gMSA6IDA7XG4gICAgICAgIGxldCBjb2xNb2QgPSBzaGlwLmdldERpcmVjdGlvbigpID09PSAnZWFzdCcgPyAxIDogMDtcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHNoaXAuZ2V0TGVuZ3RoKCk7IGkrKyl7XG4gICAgICAgICAgICBzaGlwR3JpZFtyb3ddW2NvbF0gPSBzaGlwO1xuICAgICAgICAgICAgcm93ID0gcm93ICsgKHJvd01vZCk7XG4gICAgICAgICAgICBjb2wgPSBjb2wgKyAoY29sTW9kKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9XG4gICAgY29uc3QgcmVjZWl2ZUF0dGFjayA9IChyb3csIGNvbCkgPT4ge1xuICAgICAgICBhdHRhY2tzW3Jvd11bY29sXSA9ICdoaXQnO1xuICAgICAgICBpZihzaGlwR3JpZFtyb3ddW2NvbF0pe1xuICAgICAgICAgICAgc2hpcEdyaWRbcm93XVtjb2xdLmhpdCgpO1xuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhzaGlwR3JpZFtyb3ddW2NvbF0uZ2V0SUQoKSArIFwiIHdhcyBoaXQgXCIgKyBcbiAgICAgICAgICAgIC8vc2hpcEdyaWRbcm93XVtjb2xdLmdldEhpdHNTdXN0YWluZWQoKSArIFwiIHRpbWVzLlwiKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGlzVmFsaWRBdHRhY2sgPSAocm93LCBjb2wpID0+IHtcbiAgICAgICAgcmV0dXJuIGluQm91bmRzKHJvdywgY29sKSAmJiBhdHRhY2tzW3Jvd11bY29sXSA9PT0gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgaXNEZWZlYXRlZCA9ICgpID0+IHtcbiAgICAgICAgZm9yKGxldCBzaGlwIG9mIHNoaXBBcnIpe1xuICAgICAgICAgICAgaWYoIXNoaXAuaXNTdW5rKCkpe1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBjb25zdCBpbml0RGVmYXVsdFNoaXBzID0gKCkgPT4ge1xuICAgICAgICBsZXQgc2hpcF8xID0gc2hpcEZhY3RvcnkoIDQsJ2EnLCAnZWFzdCcpO1xuICAgICAgICBwbGFjZVNoaXAoc2hpcF8xLCAwLCA0KTtcbiAgICAgICAgc2hpcEFyci5wdXNoKHNoaXBfMSk7XG5cbiAgICAgICAgbGV0IHNoaXBfMiA9IHNoaXBGYWN0b3J5KCAyLCdiJywgJ3NvdXRoJyk7XG4gICAgICAgIHBsYWNlU2hpcChzaGlwXzIsIDAsIDkpO1xuICAgICAgICBzaGlwQXJyLnB1c2goc2hpcF8yKTtcblxuICAgICAgICBsZXQgc2hpcF8zID0gc2hpcEZhY3RvcnkoIDIsJ2MnLCAnZWFzdCcpO1xuICAgICAgICBwbGFjZVNoaXAoc2hpcF8zLCAyLCAwKTtcbiAgICAgICAgc2hpcEFyci5wdXNoKHNoaXBfMyk7XG5cbiAgICAgICAgbGV0IHNoaXBfNCA9IHNoaXBGYWN0b3J5KCAzLCdkJywgJ3NvdXRoJyk7XG4gICAgICAgIHBsYWNlU2hpcChzaGlwXzQsIDMsIDQpO1xuICAgICAgICBzaGlwQXJyLnB1c2goc2hpcF80KTtcblxuICAgICAgICBsZXQgc2hpcF81ID0gc2hpcEZhY3RvcnkoIDEsJ2UnLCAnc291dGgnKTtcbiAgICAgICAgcGxhY2VTaGlwKHNoaXBfNSwgMywgNik7XG4gICAgICAgIHNoaXBBcnIucHVzaChzaGlwXzUpO1xuXG4gICAgICAgIGxldCBzaGlwXzYgPSBzaGlwRmFjdG9yeSggMywnZicsICdzb3V0aCcpO1xuICAgICAgICBwbGFjZVNoaXAoc2hpcF82LCA0LCA5KTtcbiAgICAgICAgc2hpcEFyci5wdXNoKHNoaXBfNik7XG5cbiAgICAgICAgbGV0IHNoaXBfNyA9IHNoaXBGYWN0b3J5KCAyLCdnJywgJ2Vhc3QnKTtcbiAgICAgICAgcGxhY2VTaGlwKHNoaXBfNywgNSwgMCk7XG4gICAgICAgIHNoaXBBcnIucHVzaChzaGlwXzcpO1xuXG4gICAgICAgIGxldCBzaGlwXzggPSBzaGlwRmFjdG9yeSgxLCAnaCcpO1xuICAgICAgICBwbGFjZVNoaXAoc2hpcF84LCA4LCAwKTtcbiAgICAgICAgc2hpcEFyci5wdXNoKHNoaXBfOCk7XG5cbiAgICAgICAgbGV0IHNoaXBfOSA9IHNoaXBGYWN0b3J5KDEsICdpJyk7XG4gICAgICAgIHBsYWNlU2hpcChzaGlwXzksIDksIDUpO1xuICAgICAgICBzaGlwQXJyLnB1c2goc2hpcF85KTtcblxuICAgICAgICBsZXQgc2hpcF8xMCA9IHNoaXBGYWN0b3J5KDEsICdqJyk7XG4gICAgICAgIHBsYWNlU2hpcChzaGlwXzEwLCA5LCA5KTtcbiAgICAgICAgc2hpcEFyci5wdXNoKHNoaXBfMTApO1xuICAgIH1cblxuICAgIGNvbnN0IGdldFNoaXBHcmlkID0gKCkgPT4ge1xuICAgICAgICByZXR1cm4gc2hpcEdyaWQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgcGxhY2VTaGlwLCByZWNlaXZlQXR0YWNrLCBpc1ZhbGlkQXR0YWNrLCBpc0RlZmVhdGVkLCBpbml0RGVmYXVsdFNoaXBzLCBnZXRTaGlwR3JpZCB9O1xufVxuXG5jb25zdCBjb21wdXRlclRhcmdldGluZ0FJRmFjdG9yeSA9IChib2FyZCkgPT4ge1xuICAgIGxldCBsYXN0Q29vcmRpbmF0ZXNIaXQ7XG4gICAgbGV0IGhpdFNoaXAgPSBmYWxzZTtcbiAgICBsZXQgZ2V0UmFuZCA9ICgpID0+IHtcbiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICB9XG4gICAgbGV0IHBpY2tUYXJnZXRTaW1wbGUgPSAoKSA9PiB7XG4gICAgICAgIGxldCByb3cgPSBnZXRSYW5kKCk7XG4gICAgICAgIGxldCBjb2wgPSBnZXRSYW5kKCk7XG4gICAgICAgIHdoaWxlKCFib2FyZC5pc1ZhbGlkQXR0YWNrKHJvdywgY29sKSl7XG4gICAgICAgICAgICByb3cgPSBnZXRSYW5kKCk7XG4gICAgICAgICAgICBjb2wgPSBnZXRSYW5kKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtyb3csIGNvbH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgcGlja1RhcmdldFNpbXBsZSB9O1xuXG59XG5cblxuXG5jb25zdCBnYW1lTWFzdGVyRmFjdG9yeSA9ICgpID0+IHtcbiAgICBjb25zdCBib2FyZF9wbGF5ZXIgPSBnYW1lQm9hcmRGYWN0b3J5KCk7XG4gICAgY29uc3QgYm9hcmRfY29tcHV0ZXIgPSBnYW1lQm9hcmRGYWN0b3J5KCk7XG4gICAgYm9hcmRfcGxheWVyLmluaXREZWZhdWx0U2hpcHMoKTtcbiAgICBib2FyZF9jb21wdXRlci5pbml0RGVmYXVsdFNoaXBzKCk7XG4gICAgY29uc3QgY29tcHV0ZXJUYXJnZXRpbmdBSSA9IGNvbXB1dGVyVGFyZ2V0aW5nQUlGYWN0b3J5KGJvYXJkX2NvbXB1dGVyKTtcbiAgICBsZXQgYXR0YWNrTG9jYXRpb247XG4gICAgY29uc3QgcnVuR2FtZUxvb3AgPSAoKSA9PiB7XG4gICAgICAgIHdoaWxlKHRydWUpe1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBhdHRhY2tMb2NhdGlvbiA9IGdldFBsYXllckF0dGFja0Nvb3JkaW5hdGVzKCk7XG4gICAgICAgICAgICBib2FyZF9jb21wdXRlci5yZWNlaXZlQXR0YWNrKGF0dGFja0xvY2F0aW9uLnJvdywgYXR0YWNrTG9jYXRpb24uY29sKTtcbiAgICAgICAgICAgIGlmKGJvYXJkX2NvbXB1dGVyLmlzRGVmZWF0ZWQoKSl7XG4gICAgICAgICAgICAgICAgLy9oYW5kbGUgY29tcHV0ZXIgdmljdG9yeVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBhdHRhY2tMb2NhdGlvbiA9IGNvbXB1dGVyVGFyZ2V0aW5nQUkucGlja1RhcmdldFNpbXBsZSgpO1xuICAgICAgICAgICAgYm9hcmRfcGxheWVyLnJlY2VpdmVBdHRhY2soYXR0YWNrTG9jYXRpb24ucm93LCBhdHRhY2tMb2NhdGlvbi5jb2wpO1xuICAgICAgICAgICAgaWYoYm9hcmRfcGxheWVyLmlzRGVmZWF0ZWQoKSl7XG4gICAgICAgICAgICAgICAgLy9oYW5kbGUgY29tcHV0ZXIgdmljdG9yeVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGdldFNoaXBHcmlkID0gKCkgPT4ge1xuICAgICAgICByZXR1cm4gYm9hcmRfcGxheWVyLmdldFNoaXBHcmlkKCk7XG4gICAgfVxuXG4gICAgY29uc3QgcHJvY2Vzc1VzZXJJbnB1dCA9IChyb3cgLCBjb2wpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coYFZhbGlkIGF0dGFjayAoJHtyb3d9LCAke2NvbH0pOiAke2JvYXJkX2NvbXB1dGVyLmlzVmFsaWRBdHRhY2socm93LCBjb2wpfWApO1xuICAgICAgICBpZighYm9hcmRfY29tcHV0ZXIuaXNWYWxpZEF0dGFjayhyb3csIGNvbCkpe1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGJvYXJkX2NvbXB1dGVyLnJlY2VpdmVBdHRhY2socm93LCBjb2wpO1xuICAgIH1cblxuICAgIGNvbnN0IGlzVmFsaWRBdHRhY2sgPSAocm93LCBjb2wpID0+IHtcbiAgICAgICAgcmV0dXJuIGJvYXJkX2NvbXB1dGVyLmlzVmFsaWRBdHRhY2socm93LCBjb2wpO1xuICAgIH1cblxuICAgIHJldHVybiB7IHJ1bkdhbWVMb29wLCBnZXRTaGlwR3JpZCwgcHJvY2Vzc1VzZXJJbnB1dCwgaXNWYWxpZEF0dGFjayB9O1xufVxuXG4vL21hbmFnZXMgdGhlIGdhbWUgYW5kIHRoZSB2aWV3Y29udHJvbGxlclxuY29uc3Qgd2Vic2l0ZU1hbmFnZXJGYWN0b3J5ID0gKCkgPT4ge1xuICAgIGxldCBnYW1lID0gZ2FtZU1hc3RlckZhY3RvcnkoKTtcbiAgICBjb25zdCBnZXRTaGlwR3JpZCA9ICgpID0+IHtcbiAgICAgICAgcmV0dXJuIGdhbWUuZ2V0U2hpcEdyaWQoKTtcbiAgICB9XG4gICAgY29uc3QgcHJvY2Vzc1VzZXJJbnB1dCA9IChyb3csIGNvbCwgY2xpY2spID0+IHtcbiAgICAgICAgXG4gICAgICAgIGlmKGdhbWUuaXNWYWxpZEF0dGFjayhyb3csIGNvbCkpe1xuICAgICAgICAgICAgbWFya0F0dGFjayhjbGljayk7XG4gICAgICAgIH1cbiAgICAgICAgZ2FtZS5wcm9jZXNzVXNlcklucHV0KHJvdywgY29sKTtcbiAgICB9XG4gICAgY29uc3QgaW5pdGlhdGUgPSAoKSA9PiB7XG4gICAgICAgIHNldFVwVmlldyhnYW1lLCBwcm9jZXNzVXNlcklucHV0KTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHsgaW5pdGlhdGUsIHByb2Nlc3NVc2VySW5wdXQsIGdldFNoaXBHcmlkIH07XG59XG5cblxuY29uc3Qgc2l0ZSA9IHdlYnNpdGVNYW5hZ2VyRmFjdG9yeSgpO1xuc2l0ZS5pbml0aWF0ZSgpO1xuXG5cblxuZXhwb3J0IHsgXG4gICAgc2hpcEZhY3RvcnksXG4gICAgZ2FtZUJvYXJkRmFjdG9yeSxcbiAgICBnYW1lTWFzdGVyRmFjdG9yeVxufTsiXSwibmFtZXMiOlsiY29udGFpbmVyIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiaGVhZGVyIiwiY3JlYXRlRWxlbWVudCIsIm1haW4iLCJmb290ZXIiLCJhcHBlbmRDaGlsZCIsImNyZWF0ZUNlbGwiLCJteVJvdyIsIm15Q29sIiwib3V0cHV0IiwiY2xhc3NMaXN0IiwiYWRkIiwiZGF0YXNldCIsInJvdyIsImNvbCIsImNyZWF0ZVRhYmxlSGVhZGVyIiwiY29udGVudCIsInRleHRDb250ZW50IiwiY3JlYXRlUm93Iiwicm93TnVtYmVyIiwiY3JlYXRlVGFibGUiLCJteVRhYmxlIiwiY3JlYXRlVG9wUm93Iiwic2hpcEZhY3RvcnkiLCJsZW4iLCJzaGlwSUQiLCJkaXIiLCJpZCIsImxlbmd0aCIsImRpcmVjdGlvbiIsImhpdHNTdXN0YWluZWQiLCJzdW5rIiwiZ2V0SGl0c1N1c3RhaW5lZCIsImhpdCIsImNvbnNvbGUiLCJsb2ciLCJpc1N1bmsiLCJnZXRMZW5ndGgiLCJnZXREaXJlY3Rpb24iLCJnZXRJRCIsImdhbWVCb2FyZEZhY3RvcnkiLCJzaGlwR3JpZCIsIkFycmF5IiwiZmlsbCIsIm1hcCIsImF0dGFja3MiLCJzaGlwQXJyIiwiaW5Cb3VuZHMiLCJwbGFjZVNoaXAiLCJzaGlwIiwicm93TW9kIiwiY29sTW9kIiwiaSIsImlzVmFsaWRTaGlwUGxhY2VtZW50IiwiRXJyb3IiLCJwdXNoIiwicmVjZWl2ZUF0dGFjayIsImlzVmFsaWRBdHRhY2siLCJpc0RlZmVhdGVkIiwiaW5pdERlZmF1bHRTaGlwcyIsInNoaXBfMSIsInNoaXBfMiIsInNoaXBfMyIsInNoaXBfNCIsInNoaXBfNSIsInNoaXBfNiIsInNoaXBfNyIsInNoaXBfOCIsInNoaXBfOSIsInNoaXBfMTAiLCJnZXRTaGlwR3JpZCIsImdhbWUiLCJib2FyZF9wbGF5ZXIiLCJib2FyZF9jb21wdXRlciIsImNvbXB1dGVyVGFyZ2V0aW5nQUkiLCJib2FyZCIsImdldFJhbmQiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJwaWNrVGFyZ2V0U2ltcGxlIiwiY29tcHV0ZXJUYXJnZXRpbmdBSUZhY3RvcnkiLCJhdHRhY2tMb2NhdGlvbiIsInJ1bkdhbWVMb29wIiwiZ2V0UGxheWVyQXR0YWNrQ29vcmRpbmF0ZXMiLCJwcm9jZXNzVXNlcklucHV0IiwiZ2FtZU1hc3RlckZhY3RvcnkiLCJjbGljayIsInRhcmdldCIsIm15RGl2IiwibWFya0F0dGFjayIsImluaXRpYXRlIiwidGFibGUiLCJjZWxsIiwiY2hpbGRyZW4iLCJkaXNwbGF5U2hpcHMiLCJhdHRhY2tHcmlkIiwib25jbGljayIsImF0dGFja0dyaWRGYWN0b3J5Iiwic2V0VXBWaWV3Iiwid2Vic2l0ZU1hbmFnZXJGYWN0b3J5Il0sInNvdXJjZVJvb3QiOiIifQ==